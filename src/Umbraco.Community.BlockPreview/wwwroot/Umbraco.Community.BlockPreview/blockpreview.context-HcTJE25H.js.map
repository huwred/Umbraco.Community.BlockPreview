{"version":3,"file":"blockpreview.context-HcTJE25H.js","sources":["../../assets/src/repository/sources/blockpreview.datasource.ts","../../assets/src/repository/blockpreview.repository.ts","../../assets/src/context/blockpreview.context.ts"],"sourcesContent":["import { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { UmbDataSourceResponse } from \"@umbraco-cms/backoffice/repository\";\r\nimport { tryExecuteAndNotify } from '@umbraco-cms/backoffice/resources';\r\nimport { BlockPreviewService, type BlockValueBlockGridLayoutItemModel, type BlockValueBlockListLayoutItemModel } from '@api';\r\n\r\nexport interface BlockPreviewDataSource {\r\n\r\n  previewGridMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockGridLayoutItemModel): Promise<UmbDataSourceResponse<string>>;\r\n  previewListMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockListLayoutItemModel): Promise<UmbDataSourceResponse<string>>;\r\n\r\n}\r\n\r\nexport class BlockPreviewManagementDataSource implements BlockPreviewDataSource {\r\n\r\n  #host: UmbControllerHost;\r\n\r\n  constructor(host: UmbControllerHost) {\r\n    this.#host = host;\r\n  }\r\n\r\n  async previewGridMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockGridLayoutItemModel): Promise<UmbDataSourceResponse<string>> {\r\n    return await tryExecuteAndNotify(this.#host, BlockPreviewService.postUmbracoBlockpreviewApiV1PreviewGridMarkup({ pageId, blockEditorAlias, culture, requestBody }));\r\n  }\r\n\r\n  async previewListMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockListLayoutItemModel): Promise<UmbDataSourceResponse<string>> {\r\n    return await tryExecuteAndNotify(this.#host, BlockPreviewService.postUmbracoBlockpreviewApiV1PreviewListMarkup({ pageId, blockEditorAlias, culture, requestBody }));\r\n  }\r\n\r\n }","import { UmbControllerBase } from \"@umbraco-cms/backoffice/class-api\";\r\nimport { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { BlockPreviewManagementDataSource } from \"./sources/blockpreview.datasource\";\r\nimport { BlockValueBlockGridLayoutItemModel, BlockValueBlockListLayoutItemModel } from \"@api\";\r\n\r\nexport class BlockPreviewManagementRepository extends UmbControllerBase {\r\n  #blockPreviewDataSource: BlockPreviewManagementDataSource;\r\n\r\n  constructor(host: UmbControllerHost) {\r\n    super(host);\r\n    this.#blockPreviewDataSource = new BlockPreviewManagementDataSource(this);\r\n  }\r\n\r\n  async previewGridMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockGridLayoutItemModel) {\r\n    return await this.#blockPreviewDataSource.previewGridMarkup(pageId, blockEditorAlias, culture, requestBody);\r\n  }\r\n\r\n  async previewListMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockListLayoutItemModel) {\r\n    return await this.#blockPreviewDataSource.previewListMarkup(pageId, blockEditorAlias, culture, requestBody);\r\n  }\r\n\r\n}","import { UmbControllerBase } from \"@umbraco-cms/backoffice/class-api\";\r\nimport { UmbContextToken } from \"@umbraco-cms/backoffice/context-api\";\r\nimport { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\n\r\nimport { BlockPreviewManagementRepository } from \"../repository/blockpreview.repository\";\r\n\r\nimport { type BlockValueBlockGridLayoutItemModel, type BlockValueBlockListLayoutItemModel, OpenAPI } from \"@api\";\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth'\r\nimport { UmbStringState } from \"@umbraco-cms/backoffice/observable-api\";\r\n\r\nexport class BlockPreviewManagementContext extends UmbControllerBase {\r\n\r\n  #repository: BlockPreviewManagementRepository;\r\n\r\n  #markup = new UmbStringState(\"\");\r\n  public readonly markup = this.#markup.asObservable();\r\n\r\n  constructor(host: UmbControllerHost) {\r\n    super(host);\r\n\r\n    this.provideContext(BLOCKPREVIEW_MANAGEMENT_CONTEXT_TOKEN, this);\r\n    this.#repository = new BlockPreviewManagementRepository(this);\r\n\r\n    this.consumeContext(UMB_AUTH_CONTEXT, (_auth) => {\r\n      OpenAPI.TOKEN = () => _auth.getLatestToken();\r\n      OpenAPI.WITH_CREDENTIALS = true;\r\n    });\r\n\r\n  }\r\n\r\n  async previewGridMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockGridLayoutItemModel) {\r\n    const { data } = await this.#repository.previewGridMarkup(pageId, blockEditorAlias, culture, requestBody);\r\n    if (data) {\r\n      this.#markup.setValue(data);\r\n    }\r\n  }\r\n\r\n  async previewListMarkup(pageId?: number, blockEditorAlias?: string, culture?: string, requestBody?: BlockValueBlockListLayoutItemModel) {\r\n    const { data } = await this.#repository.previewListMarkup(pageId, blockEditorAlias, culture, requestBody);\r\n    if (data) {\r\n      this.#markup.setValue(data);\r\n    }\r\n  }\r\n  \r\n}\r\n\r\nexport default BlockPreviewManagementContext;\r\n\r\nexport const BLOCKPREVIEW_MANAGEMENT_CONTEXT_TOKEN = new UmbContextToken<BlockPreviewManagementContext>(BlockPreviewManagementContext.name);"],"names":["BlockPreviewManagementDataSource","host","__privateAdd","_host","__privateSet","pageId","blockEditorAlias","culture","requestBody","tryExecuteAndNotify","__privateGet","BlockPreviewService","BlockPreviewManagementRepository","UmbControllerBase","_blockPreviewDataSource","BlockPreviewManagementContext","_repository","_markup","UmbStringState","BLOCKPREVIEW_MANAGEMENT_CONTEXT_TOKEN","UMB_AUTH_CONTEXT","_auth","OpenAPI","data","UmbContextToken"],"mappings":";;;;;;;;;;;;;;;;AAYO,MAAMA,EAAmE;AAAA,EAI9E,YAAYC,GAAyB;AAFrC,IAAAC,EAAA,MAAAC,GAAA;AAGE,IAAAC,EAAA,MAAKD,GAAQF;AAAA,EACf;AAAA,EAEA,MAAM,kBAAkBI,GAAiBC,GAA2BC,GAAkBC,GAA0F;AAC9K,WAAO,MAAMC,EAAoBC,EAAA,MAAKP,IAAOQ,EAAoB,8CAA8C,EAAE,QAAAN,GAAQ,kBAAAC,GAAkB,SAAAC,GAAS,aAAAC,EAAY,CAAC,CAAC;AAAA,EACpK;AAAA,EAEA,MAAM,kBAAkBH,GAAiBC,GAA2BC,GAAkBC,GAA0F;AAC9K,WAAO,MAAMC,EAAoBC,EAAA,MAAKP,IAAOQ,EAAoB,8CAA8C,EAAE,QAAAN,GAAQ,kBAAAC,GAAkB,SAAAC,GAAS,aAAAC,EAAY,CAAC,CAAC;AAAA,EACpK;AAED;AAdCL,IAAA;;ACTK,MAAMS,UAAyCC,EAAkB;AAAA,EAGtE,YAAYZ,GAAyB;AACnC,UAAMA,CAAI;AAHZ,IAAAC,EAAA,MAAAY,GAAA;AAIO,IAAAV,EAAA,MAAAU,GAA0B,IAAId,EAAiC,IAAI;AAAA,EAC1E;AAAA,EAEA,MAAM,kBAAkBK,GAAiBC,GAA2BC,GAAkBC,GAAkD;AACtI,WAAO,MAAME,EAAA,MAAKI,GAAwB,kBAAkBT,GAAQC,GAAkBC,GAASC,CAAW;AAAA,EAC5G;AAAA,EAEA,MAAM,kBAAkBH,GAAiBC,GAA2BC,GAAkBC,GAAkD;AACtI,WAAO,MAAME,EAAA,MAAKI,GAAwB,kBAAkBT,GAAQC,GAAkBC,GAASC,CAAW;AAAA,EAC5G;AAEF;AAfEM,IAAA;;ACIK,MAAMC,UAAsCF,EAAkB;AAAA,EAOnE,YAAYZ,GAAyB;AACnC,UAAMA,CAAI;AANZ,IAAAC,EAAA,MAAAc,GAAA;AAEA,IAAAd,EAAA,MAAAe,GAAA;AAAU,IAAAb,EAAA,MAAAa,GAAA,IAAIC,EAAe,EAAE,IACf,KAAA,SAASR,EAAA,MAAKO,GAAQ,aAAa,GAK5C,KAAA,eAAeE,GAAuC,IAAI,GAC1Df,EAAA,MAAAY,GAAc,IAAIJ,EAAiC,IAAI,IAEvD,KAAA,eAAeQ,GAAkB,CAACC,MAAU;AACvC,MAAAC,EAAA,QAAQ,MAAMD,EAAM,eAAe,GAC3CC,EAAQ,mBAAmB;AAAA,IAAA,CAC5B;AAAA,EAEH;AAAA,EAEA,MAAM,kBAAkBjB,GAAiBC,GAA2BC,GAAkBC,GAAkD;AAChI,UAAA,EAAE,MAAAe,EAAK,IAAI,MAAMb,EAAA,MAAKM,GAAY,kBAAkBX,GAAQC,GAAkBC,GAASC,CAAW;AACxG,IAAIe,KACGb,EAAA,MAAAO,GAAQ,SAASM,CAAI;AAAA,EAE9B;AAAA,EAEA,MAAM,kBAAkBlB,GAAiBC,GAA2BC,GAAkBC,GAAkD;AAChI,UAAA,EAAE,MAAAe,EAAK,IAAI,MAAMb,EAAA,MAAKM,GAAY,kBAAkBX,GAAQC,GAAkBC,GAASC,CAAW;AACxG,IAAIe,KACGb,EAAA,MAAAO,GAAQ,SAASM,CAAI;AAAA,EAE9B;AAEF;AAhCEP,IAAA,eAEAC,IAAA;AAkCK,MAAME,IAAwC,IAAIK,EAA+CT,EAA8B,IAAI;"}